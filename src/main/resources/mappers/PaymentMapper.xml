<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.PaymentMapper">

    <resultMap id="memberCustomerId" type="data.MemberCustomerId">
        <result property="memberEmail" column="member_email"/>
        <result property="customerId" column="customer_id"/>
    </resultMap>

    <resultMap id="orderDto" type="data.order.dto.OrderDto">
        <result property="orderId" column="ordersaveOrder_id"/>
        <result property="customer" column="customer"/>
        <result property="planLogId" column="plan_log_id"/>
    </resultMap>

    <select id="getCustomerUID" parameterType="string" resultMap="memberCustomerId">
        select * from members_customer_id where member_email = #{email}
    </select>

    <insert id="registerCustomerUID" parameterType="string">
        INSERT INTO members_customer_id values(#{email},#{customerId})
    </insert>

    <select id="getRealAmount" parameterType="string" resultType="int">
        select datediff(enddate,startdate) as diff from orders natural join plan where order_id = #{orderId};
    </select>

    <insert id="saveOrder" parameterType="orderDto">
        INSERT INTO orders values (null,#{orderInfo},#{memberEmail},#{schoolId},#{classId},#{totalPaymentAmount},now())
    </insert>

    <insert id="savePayment" parameterType="paymentInfo">
        INSERT INTO payment values (null,#{impUID},#{merchantUID},#{customerUID},#{tid},#{amount},now())
    </insert>

    <select id="getPaymentInfo" parameterType="string" resultType="paymentInfo">
        select imp_uid,merchant_uid,customer_uid from payment where merchant_uid = #{mid}
    </select>
</mapper>



